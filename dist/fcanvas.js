!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).fcanvas={})}(this,(function(t){"use strict";const e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return setTimeout(t,100/6)},i="ontouchstart"in window||"onmsgesturechange"in window;let s=!1;try{let t=Object.defineProperty({},"passive",{get:function(){s=!0}});function r(){}window.addEventListener("testPassive",r,t),window.removeEventListener("testPassive",r,t)}catch(t){}const n=s,o={windowWidth:{get:()=>window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},windowHeight:{get:()=>window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}};function a(t){return null==t?"null":t.replace(/^\s+|\s+$/g,"")}function h(t){const e=t.split(" ");return 2===e.length?{size:parseFloat(e[0]),family:a(e[1]),weight:"normal"}:{size:parseFloat(e[1]),family:a(e[2]),weight:a(e[0])}}function c(t,e,i){if("string"!=typeof t)return parseFloat(t+"");{t=a(t);const s=parseFloat(t);switch((t.match(/[a-z%]+$/i)||[,"px"])[1]){case"px":return s;case"em":return(i||0)*s;case"rem":return 16*(i||0);case"vw":return o.windowWidth.get()*s/100;case"vh":return o.windowHeight.get()*s/100;case"vmin":return Math.min(o.windowWidth.get(),o.windowHeight.get())*s/100;case"vmax":return Math.max(o.windowWidth.get(),o.windowHeight.get())*s/100;case"%":return e/100*s;default:return+s}}}function u(t,e){const i=t.getBoundingClientRect(),s=t.scrollWidth/t.width||1,r=t.scrollHeight/t.height||1,n=[],o=e.length;let a,h=0;for(;h<o;)a=e[h++],n.push({x:(a.clientX-i.left)/s,y:(a.clientY-i.top)/r,winX:a.clientX,winY:a.clientY,id:a.identifier});return n}function l(){let t=!1;var e;return e=navigator.userAgent||navigator.vendor,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}function d(t){return"number"==typeof t?t:parseFloat(`${t}`)}class m{__events={};on(t,e){return"function"==typeof e&&(t in this.__events?this.__events[t].push(e):this.__events[t]=[e]),()=>{this.off(t,e)}}off(t,e){"function"==typeof e?(this.__events[t]=this.__events[t].filter((t=>t!==e)),0===this.__events[t].length&&delete this.__events[t]):delete this.__events[t]}emit(t,...e){if(t in this.__events)for(let i=this.__events[t].length-1;i>-1;i--)this.__events[t][i](...e)}once(t,e){const i=(...s)=>{e(...s),this.off(t,i)};this.on(t,i)}}function f(t,e,i=[]){if(null!==t&&"object"==typeof t)if(Array.isArray(t))t.__reactive||(["push","pop","shift","unshift","splice"].forEach((s=>{const r=t[s];Object.defineProperty(t,s,{writable:!1,enumerable:!1,configurable:!0,value(){const t=r.apply(this,arguments);return e([...i],this,t),t}})})),Object.defineProperty(t,"__reactive",{writable:!1,enumerable:!1,configurable:!0,value:!0})),t.forEach(((t,s)=>{null!==t&&"object"==typeof t&&f(t,e,[...i,s+""])}));else{t.__reactive?t.__store={...t}:(Object.defineProperty(t,"__store",{writable:!0,enumerable:!1,configurable:!0,value:{...t}}),Object.defineProperty(t,"__reactive",{writable:!1,enumerable:!1,configurable:!0,value:!0}));for(const s in t)Object.defineProperty(t,s,{get:()=>t.__store?.[s],enumerable:!0,set(r){const n=t.__store?.[s];t.__store&&(t.__store[s]=r),f(r,e,[...i,s]),e([...i,s],n,r)}}),f(t[s],e,[...i,s])}}class x{__emitter=new m;constructor(t){for(const e in t)this[e]=t[e];f(this,((t,e,i)=>{this.__emitter.emit(t.join("."),e,i)}))}$set(t,e,i){t[e]=i,f(t,((t,e,i)=>{this.__emitter.emit(t.join("."),e,i)})),t[e]=i}$watch(t,e){return this.__emitter.on(t,e)}}class w{__store=new x;on(t,e){if(this.__store[t])e();else{const i=this.__store.$watch(t,(()=>{e(),i()}))}}emit(t){this.__store.$set(this.__store,t,!0)}}function g(t,e,i){return 0!==e&&(t.x=t.x%e),0!==i&&(t.y=t.y%i),t}function p(t,e,i,s){return 0!==e&&(t.x=t.x%e),0!==i&&(t.y=t.y%i),0!==s&&(t.z=t.z%s),t}class _{x;y;z;constructor(t=0,e=0,i=0){[this.x,this.y,this.z]=[t,e,i]}set(t,e,i){return t instanceof _?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0,this):(this.x=t||0,this.y=e||0,this.z=i||0,this)}copy(){return new _(this.x,this.y,this.z)}add(t,e,i){return t instanceof _?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):t instanceof Array?(this.x+=t[0]||0,this.y+=t[1]||0,this.z+=t[2]||0,this):(this.x+=t||0,this.y+=e||0,this.z+=i||0,this)}rem(t,e,i){if(t instanceof _)Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&p(this,parseFloat(t.x+""),parseFloat(t.y+""),parseFloat(t.z+""));else if(t instanceof Array)t.every((function(t){return Number.isFinite(t)}))&&(2===t.length&&g(this,t[0],t[1]),3===t.length&&p(this,t[0],t[1],t[2]||0));else if(1===arguments.length){if(Number.isFinite(arguments[0])&&0!==arguments[0])return this.x=this.x%arguments[0],this.y=this.y%arguments[0],this.z=this.z%arguments[0],this}else if(2===arguments.length){var s=[].slice.call(arguments);s.every((function(t){return Number.isFinite(t)}))&&2===s.length&&g(this,s[0],s[1])}else if(3===arguments.length){var r=[].slice.call(arguments);r.every((function(t){return Number.isFinite(t)}))&&3===r.length&&p(this,r[0],r[1],r[2])}}sub(t,e,i){return t instanceof _?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):t instanceof Array?(this.x-=t[0]||0,this.y-=t[1]||0,this.z-=t[2]||0,this):(this.x-=t||0,this.y-=e||0,this.z-=i||0,this)}mult(t){return this.x*=t,this.y*=t,this.z*=t,this}div(t){return 0===t?(console.warn("div:","divide by 0"),this):(this.x/=t,this.y/=t,this.z/=t,this)}mag(){return Math.sqrt(this.magSq())}magSq(){const{x:t,y:e,z:i}=this;return t*t+e*e+i*i}dot(t,e,i){return t instanceof _?this.dot(t.x,t.y,t.z):this.x*(t||0)+this.y*(e||0)+this.z*(i||0)}cross(t){var e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return new _(e,i,s)}normalize(){const t=this.mag();return 0!==t&&this.mult(1/t),this}limit(t){const e=this.magSq();return e>t*t&&this.div(Math.sqrt(e)).mult(t),this}setMag(t){return this.normalize().mult(t)}heading(){return Math.atan2(this.y,this.x)}rotate(t){var e=this.heading()+t,i=this.mag();return this.x=Math.cos(e)*i,this.y=Math.sin(e)*i,this}angleBetween(t){var e,i=this.dot(t)/(this.mag()*t.mag());return e=Math.acos(Math.min(1,Math.max(-1,i))),e*=Math.sign(this.cross(t).z||1)}lerp(t,e,i,s=1){return t instanceof _?this.lerp(t.x,t.y,t.z,e||0):(this.x+=(t-this.x)*s||0,this.y+=(e||0-this.y)*s||0,this.z+=(i||0-this.z)*s||0,this)}reflect(t){return t.normalize(),this.sub(t.mult(2*this.dot(t)))}array(){return[this.x||0,this.y||0,this.z||0]}equals(t,e,i){var s,r,n;return t instanceof _?(s=t.x||0,r=t.y||0,n=t.z||0):t instanceof Array?(s=t[0]||0,r=t[1]||0,n=t[2]||0):(s=t||0,r=e||0,n=i||0),this.x===s&&this.y===r&&this.z===n}toString(){return"Vector: ["+this.array().join(", ")+"]"}}function y(t,e,i){return null!=e&&null!=i&&(e-t.x)**2+(i-t.y)**2<t.radius**2}function v(t,e,i){return Math.min(Math.max(e,t),i)}function $(t){const e=new Image;return e.src=t,new Promise(((t,i)=>{e.addEventListener("load",(function i(){t(e),e.removeEventListener("load",i)})),e.addEventListener("error",(function t(s){i(s),e.removeEventListener("error",t)}))}))}function b(...t){return 1===t.length?null!==t[0]&&"object"==typeof t[0]&&"length"in t[0]?t[0][Math.floor(Math.random()*t[0].length)]:Math.random()*t[0]:2===t.length?t[0]+Math.random()*(t[1]-t[0]):void 0}function z(t,e,i){return null!=e&&null!=i&&(t.x<e&&t.x+t.width>e&&t.y<i&&t.y+t.height>i)}const M="function"==typeof Math.hypot?Math.hypot:(...t)=>{const e=t.length;let i=0,s=0;for(;i<e;)s+=Math.pow(t[i++],2);return Math.sqrt(s)};let B;function E(t,e=0,i=0,s=d(`${t.width}`),r=d(`${t.height}`),n=0){void 0===B&&(B=document.createElement("canvas").getContext("2d"));const o=n*Math.PI/180,[a,h]=function(t,e,i){return[Math.abs(t*Math.cos(i))+Math.abs(e*Math.sin(i)),Math.abs(t*Math.sin(i))+Math.abs(e*Math.cos(i))]}(s,r,o);B.canvas.width=s,B.canvas.height=r,B.save(),B.translate(s/2,r/2),B.rotate(n*Math.PI/180),B.drawImage(t,e,i,a,h,-a/2,-h/2,a,h),B.restore();const c=new Image;return c.src=B.canvas.toDataURL(),B.clearRect(0,0,s,r),c}function C(t,e,i,s,r,n=3){return function(t,e,i,s,r,n){switch(t){case"ease":return(e/=r/2)<1?s/2*Math.pow(e,n)+i:(e-=2,s/2*(Math.pow(e,n)+2)+i);case"quadratic":return(e/=r/2)<=1?s/2*e*e+i:s/2*-1*(--e*(e-2)-1)+i;case"sine-ease-in-out":return-s/2*(Math.cos(Math.PI*e/r)-1)+i;case"quintic-ease":return(e/=r/2)<1?s/2*Math.pow(e,5)+i:(e-=2,s/2*(Math.pow(e,5)+2)+i);case"exp-ease-in-out":return(e/=r/2)<1?s/2*Math.pow(2,10*(e-1))+i:(e--,s/2*(2-Math.pow(2,-10*e))+i);case"linear":return i+s/r*e}}(t,s,e,i-e,r,n)}class T{static getFrames(t,e=1e3/60){return t/e}static getValueInFrame=C;event=new m;_frame=1;type="linear";time=0;fps=1e3/60;xFrom=0;xTo=0;yFrom=0;yTo=0;zFrom=0;zTo=0;get x(){return C(this.type,this.xFrom,this.xTo,this.frame,this.frames)}get y(){return C(this.type,this.yFrom,this.yTo,this.frame,this.frames)}get z(){return C(this.type,this.zFrom,this.zTo,this.frame,this.frames)}get frames(){return T.getFrames(this.time,this.fps)}get frame(){return this._frame}set frame(t){this._frame=v(t,0,this.frames),this._frame===this.frames&&this.event.emit("done")}get running(){return this.frame<this.frames}get done(){return this.frame===this.frames}constructor(t={time:0}){this.config(t)}config({xFrom:t=0,xTo:e=0,yFrom:i=0,yTo:s=0,zFrom:r=0,zTo:n=0,type:o="linear",time:a,fps:h=1e3/60}){[this.xFrom,this.xTo,this.yFrom,this.yTo,this.zFrom,this.zTo]=[t,e,i,s,r,n],this.type=o,this.time=a,this.fps=h}set(t,e,i){[this.xFrom,this.yFrom,this.zFrom]=[t||0,e||0,i||0]}moveTo(t,e,i){this.frame=1,[this.xTo,this.yTo,this.zTo]=[t||0,e||0,i||0]}moveToSync(t,e,i){return this.moveTo(t,e,i),new Promise((t=>{this.event.once("done",(()=>t()))}))}addFrame(){this.frame++}setType(t){this.type=t}getTime(){return this.time}moveImmediate(t,e,i){[this.xFrom,this.yFrom,this.zFrom]=[this.x,this.y,this.z],this.moveTo(t,e,i)}moveImmediateSync(t,e,i){return this.moveImmediate(t,e,i),new Promise((t=>{this.event.once("done",(()=>t()))}))}}function I(t){const e=t.textContent;let i=t.nextElementSibling;if(null==i)throw new Error("fCanvas<addons/loadResourceImage>: Error because syntax error in file plist.");if("dict"===i.tagName){let t={};return Array.from(i.childNodes).filter((t=>"key"===t.tagName)).forEach((e=>{t={...t,...I(e)}})),{[e]:t}}if("array"===i.tagName){let t=[];return Array.from(i.childNodes).filter((t=>"key"===t.tagName)).forEach((e=>{t.push(I(e))})),{[e]:t}}return"string"===i.tagName?{[e]:i.textContent}:"integer"===i.tagName?{[e]:parseInt(i.textContent)}:"float"===i.tagName?{[e]:parseFloat(i.textContent)}:"true"===i.tagName?{[e]:!0}:"false"===i.tagName?{[e]:!1}:{}}class N{image;plist;__caching={};constructor(t,e){this.image=t,this.plist=e}get(t){const{frame:e,rotated:i,sourceSize:s}=this.plist.frames[t],r=e.replace(/\{|\}|\s/g,"").split(","),n=s.replace(/\{|\}|\s/g,"").split(",");t in this.__caching==!1&&(this.__caching[t]=E(this.image,+r[0],+r[1],+r[2],+r[3],i?-90:0));return Object.assign(this.__caching[t],{image:this.__caching[t],size:{width:+n[0],height:+n[1]}})}has(t){return t in this.plist.frames}}class F{update;draw;setup;setupAnimate;__autodraw=!0;_els={};_idActiveNow=-1;_queue=[];__addEl(t){t.id in this._els==!1&&(this._els[t.id]=t)}constructor(t){t?.constructor!==P&&(t=D),this.__addEl(t)}get $el(){return this.$parent.$el}_run(t){if(this.__addEl(t),this._idActiveNow=t.id,"function"==typeof this.update?(!0===this.__autodraw&&"function"==typeof this.draw&&this.draw(),this.update()):"function"==typeof this.draw&&this.draw(),this._queue.length>0){const{length:t}=this._queue;let e=0;for(;e<t;)this.run(this._queue[e]),e++}this._idActiveNow=-1}addQueue(t){this._queue.push(t)}getQueue(t){return t<0&&(t+=this._queue.length),this._queue[t]}run(t){this.$parent.run(t)}get $parent(){const t=this._els[-1===this._idActiveNow?0:this._idActiveNow];return t?.constructor===P?t:(console.warn("fCanvas: The current referenced version of the fCanvas.run function is incorrect."),this._els[0])}get $context2d(){return this.$parent.$context2d}sin(t){return this.$parent.sin(t)}asin(t){return this.$parent.asin(t)}cos(t){return this.$parent.cos(t)}acos(t){return this.$parent.asin(t)}tan(t){return this.$parent.tan(t)}atan(t){return this.$parent.atan(t)}atan2(t,e){return this.$parent.atan2(t,e)}get mouseX(){return this.$parent.mouseX}get mouseY(){return this.$parent.mouseY}get windowWidth(){return this.$parent.windowWidth}get windowHeight(){return this.$parent.windowHeight}fill(...t){this.$context2d.fillStyle=this.$parent._toRgb(t),this.$context2d.fill()}stroke(...t){this.$context2d.strokeStyle=this.$parent._toRgb(t),this.$context2d.stroke()}noFill(){this.fill(0,0,0,0)}lineWidth(t){if(void 0===t)return this.$context2d.lineWidth;this.$context2d.lineWidth=t}miterLimit(t){if(void 0===t)return this.$context2d.miterLimit;"miter"!==this.lineJoin()&&this.lineJoin("miter"),this.$context2d.miterLimit=t}shadowOffset(t,e){if(0===arguments.length)return{x:this.$context2d.shadowOffsetX,y:this.$context2d.shadowOffsetY};[this.$context2d.shadowOffsetX,this.$context2d.shadowOffsetY]=[t||0,e||0]}measureText(t){return this.$context2d.measureText(t).width}begin(){this.$context2d.beginPath()}close(){this.$context2d.closePath()}save(){this.$parent.save()}restore(){this.$parent.restore()}rotate(t){if(void 0===t)return this.$parent.rotate();this.$parent.rotate(t)}translate(t,e){if(0===arguments.length)return this.$parent.translate();this.$parent.translate(t,e)}arc(t,e,i,s,r,n){this.begin(),this.$context2d.arc(t,e,i,this.$parent._toRadius(s)-Math.PI/2,this.$parent._toRadius(r)-Math.PI/2,n),this.close()}pie(t,e,i,s,r,n){this.begin(),this.move(t,e),this.arc(t,e,i,s,r,n),this.to(t,e),this.close()}line(t,e,i,s){this.move(t,e),this.to(i,s)}ellipse(t,e,i,s,r,n,o){this.begin(),this.$context2d.ellipse(t,e,i,s,this.$parent._toRadius(r)-Math.PI/2,this.$parent._toRadius(n),o),this.close()}circle(t,e,i){this.arc(t,e,i,0,"degress"===this.$parent.angleMode()?360:2*Math.PI)}point(t,e){this.circle(t,e,1)}triange(t,e,i,s,r,n){this.begin(),this.move(t,e),this.to(i,s),this.to(r,n),this.close()}drawImage(t,...e){this.$context2d.drawImage(t,...e)}rect(t,e,i,s,r,n,o,a){if(this.begin(),[t,e]=this.$parent._figureOffset(t,e,i,s),arguments.length<5)this.$context2d.rect(t,e,i,s);else{const h=this.$parent.fontSize(),u=[c(r,i,h),c(n,s,h),c(o,i,h),c(a,s,h)];this.move(t,e),this.arcTo(t+i,e,t+i,e+s-u[1],u[1]),this.arcTo(t+i,e+s,t+i-u[2],e+s,u[2]),this.arcTo(t,e+s,t,e+s-u[3],u[3]),this.arcTo(t,e,t+i-u[0],e,u[0])}this.close()}quadratic(t,e,i,s){this.$context2d.quadraticCurveTo(t,e,i,s)}bezier(t,e,i,s,r,n){this.$context2d.bezierCurveTo(t,e,i,s,r,n)}move(t,e){this.$context2d.moveTo(t,e)}to(t,e){this.$context2d.lineTo(t,e)}fillText(t,e,i,s){this.$context2d.fillText(t,e,i,s)}strokeText(t,e,i,s){this.$context2d.strokeText(t,e,i,s)}fillRect(t,e,i,s){this.$context2d.fillRect(t,e,i,s)}strokeRect(t,e,i,s){this.$context2d.strokeRect(t,e,i,s)}lineDashOffset(t){if(void 0===t)return this.$context2d.lineDashOffset;this.$context2d.lineDashOffset=t}lineDash(...t){if(0===t.length)return this.$context2d.getLineDash();Array.isArray(t[0])&&this.$context2d.setLineDash(t[0]),this.$context2d.setLineDash(t)}arcTo(t,e,i,s,r){this.$context2d.arcTo(t,e,i,s,r)}isPoint(t,e){return this.$context2d.isPointInPath(t,e)}createImageData(t,e){return e?this.$parent.createImageData(t,e):this.$parent.createImageData(t)}getImageData(t,e,i,s){return this.$parent.getImageData(t,e,i,s)}putImageData(t,e,i,s,r,n,o){7===arguments.length?this.$parent.putImageData(t,e,i,s,r,n,o):this.$parent.putImageData(t,e,i)}createPattern(t,e){return this.$parent.createPattern(t,e)}createRadialGradient(t,e,i,s,r,n){return this.$parent.createRadialGradient(t,e,i,s,r,n)}createLinearGradient(t,e,i,s){return this.$parent.createLinearGradient(t,e,i,s)}lineJoin(t){if(void 0===t)return this.$context2d.lineJoin;this.$context2d.lineJoin=t}lineCap(t){if(void 0===t)return this.$context2d.lineCap;this.$context2d.lineCap=t}shadowBlur(t){if(void 0===t)return this.$context2d.shadowBlur;this.$context2d.shadowBlur=t}shadowColor(...t){this.$context2d.shadowColor=this.$parent._toRgb(t)}drawFocusIfNeeded(t,e){void 0===e?this.$context2d.drawFocusIfNeeded(t):this.$context2d.drawFocusIfNeeded(t,e)}}class k extends F{animate=new T;constructor(t){super(),t&&this.animate.config(t)}}class R extends F{type="rect";x=0;y=0;width=0;height=0;constructor(t,e,i,s){super(),[this.x,this.y,this.width,this.height]=[t||0,e||0,i||0,s||0]}get interact(){return z(this,this.mouseX,this.mouseY)}}class A extends F{type="circle";x=0;y=0;radius=0;constructor(t,e,i){super(),[this.x,this.y,this.radius]=[t||0,e||0,i||0]}get interact(){return y(this,this.mouseX,this.mouseY)}}class V extends F{x=0;y=0;z=0;constructor(t,e,i){super(),[this.x,this.y,this.z]=[t||0,e||0,i||0]}rotateX(t){this.y=this.y*this.$parent.cos(t)+this.z*this.$parent.sin(t),this.z=-this.y*this.$parent.sin(t)+this.z*this.$parent.cos(t)}rotateY(t){this.x=this.x*this.$parent.cos(t)+this.z*this.$parent.sin(t),this.z=-this.x*this.$parent.sin(t)+this.z*this.$parent.cos(t)}rotateZ(t){this.x=this.x*this.$parent.cos(t)-this.y*this.$parent.sin(t),this.y=this.x*this.$parent.sin(t)+this.y*this.$parent.cos(t)}draw=()=>{this.point(this.x,this.y)}}class P{static Element=F;static EAnimate=k;static RectElement=R;static CircleElement=A;static Point3D=V;static count=0;_ENV={angleMode:"degress",rectAlign:"left",rectBaseline:"top",colorMode:"rgb",rotate:0,clear:!0,loop:!0};_id=P.count++;_el=document.createElement("canvas");_context2dCaching=null;_stamentReady=new w;_existsPreload=!1;__translate={x:0,y:0,sumX:0,sumY:0};__scale={x:0,y:0,sumX:0,sumY:0};__idFrame=null;__attributeContext={alpha:!0,desynchronized:!1};preventTouch=!1;stopTouch=!1;touches=[];changedTouches=[];get mouseX(){return this.touches[0]?.x||null}get mouseY(){return this.touches[0]?.y||null}get interact(){return this.touches.length>0}get id(){return this._id}get $el(){return this._el}_createNewContext2d(){this._context2dCaching=this.$el.getContext("2d",this.__attributeContext)}acceptBlur(){return this.__attributeContext.alpha}blur(){this.__attributeContext.alpha=!0,this._createNewContext2d()}noBlur(){this.__attributeContext.alpha=!1,this._createNewContext2d()}acceptDesync(){return this.__attributeContext.desynchronized}desync(){this.__attributeContext.desynchronized=!0,this._createNewContext2d()}noDesync(){this.__attributeContext.desynchronized=!1,this._createNewContext2d()}get $context2d(){return null===this._context2dCaching&&this._createNewContext2d(),this._context2dCaching}constructor(){const t=t=>{try{"mouseout"!==t.type?(this.touches=u(this.$el,t.touches||[t]),this.changedTouches=u(this.$el,t.changedTouches||[t])):this.touches=[],this.preventTouch&&t.preventDefault(),this.stopTouch&&t.stopPropagation()}catch(t){}};this.$el.addEventListener(l()?"touchstart":"mouseover",t),this.$el.addEventListener(l()?"touchmove":"mousemove",t),this.$el.addEventListener(l()?"touchend":"mouseout",t)}append(t=document.body){!1===t.contains(this.$el)&&t.appendChild(this.$el)}noClear(){this._ENV.clear=!1}get acceptClear(){return this._ENV.clear}run(t){t._run(this)}get width(){return this.$el.width}set width(t){this.$el.width=t}get height(){return this.$el.height}set height(t){this.$el.height=t}get windowWidth(){return o.windowWidth.get()}get windowHeight(){return o.windowHeight.get()}save(){this.$context2d.save()}restore(){this.$context2d.restore()}_toRadius(t){return"degress"===this._ENV.angleMode?t*Math.PI/180:t}_toDegress(t){return"radial"===this._ENV.angleMode?180*t/Math.PI:t}_toRgb([t=0,e=t,i=e,s=1]){if(Array.isArray(t))return this._toRgb(t);if("string"==typeof t)return t;{const r=this._ENV.colorMode.match(/hsl|hsb/i)?"%":"";return`${this._ENV.colorMode}a(${[t,e+r,i+r,s].join(",")})`}}_figureOffset(t,e,i,s){switch(this._ENV.rectAlign){case"center":t-=i/2;break;case"right":t-=i}switch(this._ENV.rectBaseline){case"middle":e-=s/2;break;case"bottom":e-=s}return[t,e]}angleMode(t){if(void 0===t)return this._ENV.angleMode;this._ENV.angleMode=t}rectAlign(t){if(void 0===t)return this._ENV.rectAlign;this._ENV.rectAlign=t}colorMode(t){if(void 0===t)return this._ENV.colorMode;this._ENV.colorMode=t}rectBaseline(t){if(void 0===t)return this._ENV.rectBaseline;this._ENV.rectBaseline=t}fontSize(t){const{size:e,weight:i,family:s}=h(this.font());if(void 0===t)return e;t=c(t,e,e),this.font([i,`${t}px`,s].join(" "))}fontFamily(t){const{size:e,weight:i,family:s}=h(this.font());if(void 0===t)return s;this.font([i,`${e}px`,t].join(" "))}fontWeight(t){const{size:e,weight:i,family:s}=h(this.font());if(void 0===t)return i;this.font([t,`${e}px`,s].join(" "))}clear(t=0,e=0,i=this.width,s=this.height){this.$context2d.clearRect(t,e,i,s)}background(...t){this.$context2d.fillStyle=this._toRgb(t),this.$context2d.fill(),this.$context2d.fillRect(0,0,this.width,this.height)}backgroundImage(t){this.$context2d.drawImage(t,0,0,this.width,this.height)}createImageData(t,e){return e?this.$context2d.createImageData(t,e):this.$context2d.createImageData(t)}getImageData(t,e,i,s){return this.$context2d.getImageData(t,e,i,s)}putImageData(t,e,i,s,r,n,o){7===arguments.length?this.$context2d.putImageData(t,e,i,s,r,n,o):this.$context2d.putImageData(t,e,i)}createPattern(t,e){return this.$context2d.createPattern(t,e)}createRadialGradient(t,e,i,s,r,n){return this.$context2d.createRadialGradient(t,e,i,s,r,n)}createLinearGradient(t,e,i,s){return this.$context2d.createLinearGradient(t,e,i,s)}toDataURL(t="image/png",e){return this.$el.toDataURL(t,e)}rotate(t){if(void 0===t)return this._ENV.rotate;this.$context2d.rotate(this._ENV.rotate=this._toRadius(t))}resetTransform(){this.setTransform(1,0,0,1,0,0)}async preload(t){this._existsPreload=!0,await t(),this._stamentReady.emit("preloaded")}async setup(t){this._existsPreload?this._stamentReady.on("preloaded",(async()=>{await q(t),this._stamentReady.emit("setuped")})):(await q(t),this._stamentReady.emit("setuped"))}draw(t){this._stamentReady.on("setuped",(()=>{O(t,this)}))}font(t){if(void 0===t)return this.$context2d.font;this.$context2d.font=t}textAlign(t){if(void 0===t)return this.$context2d.textAlign;this.$context2d.textAlign=t}textBaseline(t){if(void 0===t)return this.$context2d.textBaseline;this.$context2d.textBaseline=t}operation(t){if(void 0===t)return this.$context2d.globalCompositeOperation;this.$context2d.globalCompositeOperation=t}alpha(t){if(void 0===t)return this.$context2d.globalAlpha;this.$context2d.globalAlpha=t}translate(t,e){if(0===arguments.length)return{x:this.__translate.x,y:this.__translate.y};this.$context2d.translate(t,e),this.__translate.sumX+=t||0,this.__translate.sumY+=e||0}resetTranslate(){this.$context2d.translate(-this.__translate.sumX,-this.__translate.sumY)}scale(t,e){if(0===arguments.length)return{x:this.__scale.x,y:this.__scale.y};this.$context2d.scale(t,e),this.__scale.sumX+=t||0,this.__scale.sumY+=e||0}resetScale(){this.$context2d.translate(-this.__translate.sumX,-this.__translate.sumY)}clip(t,e){void 0===e&&this.$context2d.clip(t),this.$context2d.clip(e,t)}transform(t,e,i,s,r,n){if(0===arguments.length)return this.$context2d.getTransform();if(t instanceof DOMMatrix){const{a:e=1,b:i=0,c:s=0,d:r=1,e:n=0,f:o=0}=t;this.$context2d.transform(e,i,s,r,n,o)}else this.$context2d.transform(t,e,i,s,r,n)}setTransform(t,e,i,s,r,n){if(t instanceof DOMMatrix){const{a:e=1,b:i=0,c:s=0,d:r=1,e:n=0,f:o=0}=t;this.$context2d.setTransform(e,i,s,r,n,o)}else this.$context2d.setTransform(t,e,i,s,r,n)}sin(t){return Math.sin(this._toRadius(t))}asin(t){return this._toDegress(Math.asin(t))}cos(t){return Math.cos(this._toRadius(t))}acos(t){return this._toDegress(Math.acos(t))}tan(t){return Math.tan(this._toRadius(t))}atan(t){return this._toDegress(Math.atan(t))}atan2(t,e){return this._toDegress(Math.atan2(t,e))}cursor(){this.$el.style.cursor="auto"}noCursor(){this.$el.style.cursor="none"}loop(){this._ENV.loop=!0,this._stamentReady.emit("setuped")}noLoop(){this._ENV.loop=!1,this.__idFrame&&(cancelAnimationFrame||webkitCancelAnimationFrame||clearTimeout)(this.__idFrame)}get acceptLoop(){return this._ENV.loop}mouseIn(t){return L("mouseover",t,this.$el)}mouseOut(t){return L("mouseout",t,this.$el)}mouseDown(t){return L("mousedown",t,this.$el)}touchStart(t){return L("touchstart",t,this.$el)}touchMove(t){return L("touchmove",t,this.$el)}touchEnd(t){return L("touchend",t,this.$el)}mouseMoved(t){return L("mousemove",t,this.$el)}mouseUped(t){return L("mouseup",t,this.$el)}mouseClicked(t){return L("click",t,this.$el)}}const D=new P;function L(t,e,i){return i.addEventListener(t,e),()=>{i.removeEventListener(t,e)}}let X=!1;const Y=new m;async function q(t){if("complete"===document.readyState){const e=t();e&&"length"in e&&await e,X=!0,Y.emit("load")}else await new Promise(((e,i)=>{function s(){document.removeEventListener("DOMContentLoaded",s),window.removeEventListener("load",s),t(),e(),X=!0,Y.emit("load")}document.addEventListener("DOMContentLoaded",s),window.addEventListener("load",s)}))}function j(t,i){!0===i.acceptClear&&i.clear(),t(),!0===i.acceptLoop&&e((()=>j(t,i)))}function O(t,e){X?e?j(t,e):t():Y.once("load",(()=>{O(t,e)}))}t.Animate=T,t.Camera=class{viewport={width:0,height:0};viewBox={mx:0,my:0,width:0,height:0};_cx=0;_cy=0;get cx(){return this._cx}set cx(t){this.cursor.use?this._cx=v(t,-this.cursor.idealX-this.viewBox.mx-this.cursor.offsetLeft,this.viewport.width-this.viewBox.width+(this.viewBox.width-this.cursor.idealX-this.cursor.width)+this.cursor.offsetRight):this._cx=v(t,-this.viewBox.mx,this.viewport.width-this.viewBox.width)}get cy(){return this._cy}set cy(t){this.cursor.use?this._cy=v(t,-this.cursor.idealY-this.viewBox.my-this.cursor.offsetTop,this.viewport.height-this.viewBox.height+(this.viewBox.height-this.cursor.idealY-this.cursor.height)+this.cursor.offsetBottom):this._cy=v(t,-this.viewBox.my,this.viewport.height-this.viewBox.height)}cursor={__camera:this,use:!0,idealX:0,idealY:0,idealRX:0,offsetTop:0,offsetRight:0,offsetBottom:0,offsetLeft:0,width:0,height:0,get x(){if(this.__camera._cx<-this.__camera.viewBox.mx){const t=-this.__camera.viewBox.mx-this.__camera._cx;return this.idealX-t}if(this.__camera._cx>this.__camera.viewport.width-this.__camera.viewBox.width){const t=this.__camera.viewport.width-this.__camera.viewBox.width-this.__camera._cx;return this.idealX-t}return this.idealX},set x(t){t<this.idealX&&(this.__camera._cx=t-this.idealX-this.__camera.viewBox.mx),t>this.idealX+this.idealRX&&(this.__camera._cx=t-this.idealX+this.__camera.viewport.width-this.__camera.viewBox.width-this.width)},get y(){if(this.__camera._cy<-this.__camera.viewBox.my){const t=-this.__camera.viewBox.my-this.__camera._cy;return this.idealY-t}if(this.__camera._cy>this.__camera.viewport.height-this.__camera.viewBox.height){const t=this.__camera.viewport.height-this.__camera.viewBox.height-this.__camera._cy;return this.idealY-t}return this.idealY},set y(t){t<this.idealY&&(this.__camera._cy=t-this.idealY-this.__camera.viewBox.my),t>this.idealY&&(this.__camera._cy=t-this.idealY+this.__camera.viewport.height-this.__camera.viewBox.height-this.height)}};constructor(t,e,i,s,r,n,o,a,h,c){this.setViewport(t||0,e||0),this.setViewBox(i||0,s||0,r||0,n||0),!1===o?this.setCursor(!1):this.setCursor(o,a,h,c)}setViewport(t,e){this.viewport.width=t||0,this.viewport.height=e||0}setViewBox(t,e,i,s){this.viewBox.mx=t||0,this.viewBox.my=e||0,this.viewBox.width=i||0,this.viewBox.height=s||0}setCursor(t,e,i,s){1===arguments.length?!1===t&&(this.cursor.use=!1):(this.cursor.idealX=t||0,this.cursor.idealY=e||0,this.cursor.width=i||0,this.cursor.height=s||0)}followX(t,e=1){return t-v(this._cx*e,-this.viewBox.mx,this.viewport.width-this.viewBox.width)}followY(t,e=1){return t-v(this._cy*e,-this.viewBox.my,this.viewport.height-this.viewBox.height)}followVector(t,e=1,i=e){return t.set(this.followX(t.x,e),this.followY(t.y,i))}follow(t,e,i=1,s=i){return{x:this.followX(t,i),y:this.followY(e,s)}}xInViewBox(t,e=0,i=1){return t=this.followX(t,i),this.viewBox.mx<t+e&&this.viewBox.mx+this.viewBox.width>t}yInViewBox(t,e=0,i=1){return t=this.followY(t,i),this.viewBox.my<t+e&&this.viewBox.my+this.viewBox.height>t}inViewBox(t,e,i=0,s=0,r=1,n=r){return this.xInViewBox(t,i,r)&&this.yInViewBox(e,s,n)}xAfterViewBox(t,e=0,i=1){return t=this.followX(t,i),this.viewBox.mx>=t+e}yAfterViewBox(t,e=0,i=1){return t=this.followY(t,i),this.viewBox.my>=t+e}afterViewBox(t,e,i=0,s=0,r=1,n=r){return this.xAfterViewBox(t,i,r)&&this.yAfterViewBox(e,s,n)}xBeforeViewBox(t,e=0,i=1){return t=this.followX(t,i),this.viewBox.mx+this.viewBox.width<=t}yBeforeViewBox(t,e=0,i=1){return t=this.followY(t,i),this.viewBox.my+this.viewBox.height<=t}beforeViewBox(t,e,i=0,s=0,r=1,n=r){return this.xBeforeViewBox(t,i,r)&&this.yBeforeViewBox(e,s,n)}},t.CircleImpact=function(t,e){return(t.x-e.x)**2+(t.y-e.y)**2<(t.radius+e.radius)**2},t.CircleImpactPoint=y,t.CircleImpactRect=function(t,e){const i=Math.max(e.x,Math.min(t.x,e.x+e.width)),s=Math.max(e.y,Math.min(t.y,e.y+e.height));return(i-t.x)*(i-t.x)+(s-t.y)*(s-t.y)<t.radius**2},t.Emitter=m,t.RectImpact=function(t,e){return t.x<=e.x+e.width&&t.x+t.width>=e.x&&t.y<=e.y+e.height&&t.y+t.height>=e.y},t.RectImpactPoint=z,t.Stament=w,t.Store=x,t.Vector=_,t.changeSize=function(t,e=window){return L("resize",t,e)},t.constrain=v,t.cutImage=E,t.default=P,t.draw=O,t.foreach=function(t,e,i,s=(()=>{})){if("number"==typeof t){"function"==typeof i&&(s=i,i=1),i=i||1;for(let r=t;r<=e&&!0!==s(r,t,e,i);r+=i);}else if("function"==typeof e&&(s=e),"function"==typeof i&&(s=i),"length"in t){const{length:i}=t;let r=0;for("number"!=typeof e&&(e=i),e<0&&(e+=i);r<i&&!0!==s.call(t,t[r],r,t)&&!(r>e);)r++}else for(const e in t)if(!0===s.call(t,t[e],e,t))break},t.hypot=M,t.isMobile=l,t.isTouch=i,t.keyPressed=function(t,e=window){return L("keydown",t,e)},t.keyUp=function(t,e=window){return L("keyup",t,e)},t.lerp=function(t,e,i){return i*(e-t)+t},t.loadAudio=function(t){const e=new Audio;return e.src=t,new Promise(((t,i)=>{e.addEventListener("load",(function i(){t(e),e.removeEventListener("load",i)})),e.addEventListener("error",(function t(s){i(s),e.removeEventListener("error",t)}))}))},t.loadImage=$,t.loadResourceImage=async function(t){null==t.match(/\.plist$/)&&(t+=".plist");const e=await fetch(`${t}`).then((t=>t.text())).then((t=>(new DOMParser).parseFromString(t,"text/xml")));let i={};e.querySelectorAll("plist > dict:first-child > key").forEach((t=>{i={...i,...I(t)}}));const s=await $(function(...t){const e=t[0].replace(/\/$/,"").split("/");return t[0]=e.slice(0,e.length-1).join("/"),t.join("/")}(t,i?.metadata.realTextureFileName||i?.metadata.textureFileName));return new N(s,i)},t.map=function(t,e,i,s,r){return(t-e)*(r-s)/(i-e)+s},t.mouseClicked=function(t,e=window){return L("click",t,e)},t.mouseMoved=function(t,e=window){return L("mousemove",t,e)},t.mousePressed=function(t,e=window){return L("mousedown",t,e)},t.mouseWheel=function(t,e=window){return L("wheel",t,e)},t.odd=function(t,e,i){return t===e?i:t+1},t.off=function(t,e,i){return t===e?i:t-1},t.passive=n,t.random=b,t.randomInt=function(t,e){return void 0===e?Math.round(b(t)):Math.round(b(t,e))},t.range=function(t,e,i){i=i||1;const s=[];let r=!1;if(void 0===e&&(e=t,t=1),"string"==typeof t&&(t=t.charCodeAt(0),e=e.charCodeAt(0),r=!0),t!==e&&Math.abs(e-t)<Math.abs(i))throw new Error("range(): step exceeds the specified range.");if(e>t)for(i<0&&(i*=-1);t<=e;)s.push(r?String.fromCharCode(t):t),t+=i;else for(i>0&&(i*=-1);t>=e;)s.push(r?String.fromCharCode(t):t),t+=i;return s},t.requestAnimationFrame=e,t.setup=q,t.touchEnd=function(t,e=window){return L("touchend",t,e)},t.touchMove=function(t,e=window){return L("touchmove",t,e)},t.touchStart=function(t,e=window){return L("touchstart",t,e)},t.windowSize=o,Object.defineProperty(t,"__esModule",{value:!0})}));
